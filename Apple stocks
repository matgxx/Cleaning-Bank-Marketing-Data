import pandas as pd

raw_data = pd.read_csv('archive/apple_5yr_one.csv')

for col in ['Close', 'High', 'Low', 'Open', 'Volume']:
    raw_data[col] = pd.to_numeric(raw_data[col], errors='coerce')

def transform(raw_data):
    print(raw_data.isnull().sum())

    raw_data = raw_data.dropna() 

    raw_data = raw_data.drop_duplicates(subset=['Date'])

    raw_data = raw_data[raw_data['High'] >= raw_data['Low']]

    raw_data = raw_data.sort_values('Date')

    raw_data['Daily_Return'] = raw_data['Close'].pct_change()

    return raw_data 

clean_data = transform(raw_data)

new_file_path = 'archive/apple_cleaned.csv'

def load(clean_data, new_file_path):
    clean_data.to_csv(new_file_path, index=False)
    print(f"Data saved to {new_file_path}")

load(clean_data, new_file_path)
